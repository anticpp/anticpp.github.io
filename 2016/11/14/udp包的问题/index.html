<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>udp包的问题 | supergui</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="最近研究了一下udp相关的东西，做下笔记。这里有相关的测试代码。
udp包一般多少适合协议层的限制，理论上我们可以发送接收65535(0xFFFF)大小的udp包。为了避免IP层分片，udp包在ethernet上一般不超过1472(1500-20-8)，1500为ethernet的链路MTU。实际上很多应用（例如DNS）的udp包都不超过512，为什么呢？
这是Stack Overflow上面的一">
<meta property="og:type" content="article">
<meta property="og:title" content="udp包的问题">
<meta property="og:url" content="http://anticpp.github.io/2016/11/14/udp包的问题/index.html">
<meta property="og:site_name" content="supergui">
<meta property="og:description" content="最近研究了一下udp相关的东西，做下笔记。这里有相关的测试代码。
udp包一般多少适合协议层的限制，理论上我们可以发送接收65535(0xFFFF)大小的udp包。为了避免IP层分片，udp包在ethernet上一般不超过1472(1500-20-8)，1500为ethernet的链路MTU。实际上很多应用（例如DNS）的udp包都不超过512，为什么呢？
这是Stack Overflow上面的一">
<meta property="og:updated_time" content="2018-04-17T09:44:52.579Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="udp包的问题">
<meta name="twitter:description" content="最近研究了一下udp相关的东西，做下笔记。这里有相关的测试代码。
udp包一般多少适合协议层的限制，理论上我们可以发送接收65535(0xFFFF)大小的udp包。为了避免IP层分片，udp包在ethernet上一般不超过1472(1500-20-8)，1500为ethernet的链路MTU。实际上很多应用（例如DNS）的udp包都不超过512，为什么呢？
这是Stack Overflow上面的一">
  
    <link rel="alternate" href="/atom.xml" title="supergui" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">supergui</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">迁于乔木，出自幽谷</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://anticpp.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="udp_about-udp包的问题" class="article article-type-udp_about" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/14/udp包的问题/" class="article-date">
  <time datetime="2016-11-14T11:51:27.000Z" itemprop="datePublished">2016-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      udp包的问题
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近研究了一下udp相关的东西，做下笔记。<br>这里有相关的<a href="https://www.github.com/anticpp/experiments" target="_blank" rel="external">测试代码</a>。</p>
<h1 id="udp包一般多少适合"><a href="#udp包一般多少适合" class="headerlink" title="udp包一般多少适合"></a>udp包一般多少适合</h1><p>协议层的限制，理论上我们可以发送接收65535(0xFFFF)大小的udp包。为了避免IP层分片，udp包在ethernet上一般不超过1472(1500-20-8)，1500为ethernet的链路MTU。<br>实际上很多应用（例如DNS）的udp包都不超过512，为什么呢？</p>
<p>这是Stack Overflow上面的一句话<br>    The maximum safe UDP payload is 508 bytes. This is a packet size of 576, minus the maximum 60-byte IP header and the 8-byte UDP header. Any UDP payload this size or smaller is guaranteed to be deliverable over IP (though not guaranteed to be delivered). Anything larger is allowed to be outright dropped by any router for any reason.<br>按照字面理解的意思是，大于576的udp包在路由链路保证不了一定传输，难道是路由器的实现潜规则？</p>
<ul>
<li>更新At 2016-11-14<br>似乎RFC的IPV4标准里面有定义。</li>
</ul>
<p>RFC 791 excerpt:<br>…<br>All hosts must be prepared to accept datagrams of up to 576 octets ( whether they arrive whole or in fragments ). It is recommended that hosts only send datagrams larger than 576 octets if they have assurance that the destination is prepared to accept the larger datagrams.<br>The number 576 is selected to allow a reasonable sized data block to be transmitted in addition to the required header information. For example, this size allows a data block of 512 octets plus 64 header octets to fit in a datagram. The maximal internet header is 60 octets, and a typical internet header is 20 octets, allowing a margin for headers of higher level protocols.<br>…</p>
<p>既然这样，另外一个问题来了，为什么TCP的MSS一般不受这个限制。<br>是因为TCP有做链路MTU探测，以及稳定的重传机制吗？</p>
<h1 id="udp-socket缓冲区"><a href="#udp-socket缓冲区" class="headerlink" title="udp socket缓冲区"></a>udp socket缓冲区</h1><ol>
<li><p>发送缓冲区<br>经常有一个误解是udp没有发送缓冲区，实际udp也有发送缓冲区。只不过udp并不是流协议，发送缓冲区只会缓存一个包，然后立刻就被拷贝到内核协议栈。<br>如果发送一个超过缓冲区大小的udp包，大多数的实现是直接丢弃。</p>
</li>
<li><p>接收缓冲区<br>接收缓冲区跟发送缓冲区有点不一样，所有的udp包会按照先后顺序缓存，应用层每次读会返回最早的包。实际上接收缓冲区就是FIFO队列。<br>如果接收缓冲区大小不够，大多数的实现是直接丢弃整个包。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://anticpp.github.io/2016/11/14/udp包的问题/" data-id="cklu9c49r000k7rp3c4z4f5pq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/11/23/SSL-TLS/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          SSL/TLS
        
      </div>
    </a>
  
  
    <a href="/2016/03/31/ffmpeg/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ffmpeg</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go-C-virtual-interface/">Go C++ virtual interface</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IP/">IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/p2p-dht/">p2p dht</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术/">技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/视频/">视频</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Go-C-virtual-interface/" style="font-size: 10px;">Go C++ virtual interface</a> <a href="/tags/IP/" style="font-size: 10px;">IP</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/p2p-dht/" style="font-size: 10px;">p2p dht</a> <a href="/tags/技术/" style="font-size: 20px;">技术</a> <a href="/tags/视频/" style="font-size: 10px;">视频</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/04/message-queue/">message-queue</a>
          </li>
        
          <li>
            <a href="/2018/05/11/gopher-2018/">gopher-2018</a>
          </li>
        
          <li>
            <a href="/2018/05/05/cpp-virtual-vs-go-interface/">Go interface internal</a>
          </li>
        
          <li>
            <a href="/2018/05/03/private-addr/">IPV4私有地址</a>
          </li>
        
          <li>
            <a href="/2018/04/17/dht/">DHT</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 supergui@live.cn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>